@using ProjectHermes.ShoppingList.Frontend.WebApp.Services.Error
@using ProjectHermes.ShoppingList.Frontend.Models.Items
@using ProjectHermes.ShoppingList.Frontend.Models.Items.Models
@using ProjectHermes.ShoppingList.Frontend.WebApp.Pages.Items.Models
@using ProjectHermes.ShoppingList.Frontend.WebApp.Pages.Items.Services


@inject IItemsApiService _loadingService;

<div>
    <Input TValue="string" @bind-value="@input" OnPressEnter="@OnLoadButtonClickedAsync"></Input>
    <Button @onclick="@OnLoadButtonClickedAsync" Class="mt-2">Load</Button>
</div>

@code {
    [Parameter] public ItemsState State { get; set; }
    [Parameter] public IAsyncRetryFragmentCreator FragmentCreator { get; set; }

    private string input = "";

    private async Task OnLoadButtonClickedAsync()
    {
        if (string.IsNullOrWhiteSpace(input))
        {
            State.UpdateItems(Enumerable.Empty<SearchItemResult>());
            return;
        }

        await _loadingService.SearchItemsAsync(input, FragmentCreator, items => State.UpdateItems(items));
    }
}
