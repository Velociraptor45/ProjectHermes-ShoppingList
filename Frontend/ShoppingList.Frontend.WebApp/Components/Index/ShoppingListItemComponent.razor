@using ShoppingList.Frontend.Models;

<li class="list-style-non py-2 mb-1 @(Item.IsInBasket ? "green-bg" : "red-bg") white" @onclick="OnItemClickedAsync">
    @if (IsInEditMode)
    {
        <div class="d-flex flex-column">
            <div class="d-flex">
                <!-- upper row -->
                <div class="h3">@Item.Name</div>
                <Button Danger="true"
                        Icon="close"
                        Class="mr-2 ml-auto d-flex align-items-center justify-content-center"
                        OnClick="@OnRemoveItemButtonClickedAsync"></Button>
            </div>
            <div class="d-flex">
                <!-- lower row -->
                <div class="d-flex mr-3">
                    <AntDesign.InputNumber Value="@Item.Quantity" Min="1f"
                                           ValueChanged="@(async (float d) => await OnQuantityInputValueChangedAsync(d))">
                    </AntDesign.InputNumber>
                    <span>g</span>
                </div>
                <div class="d-flex">
                    <Button Class="d-flex align-items-center justify-content-center" Icon="plus"
                            OnClick="OnIncrementQuantityButtonClicked"></Button>
                    <Button Class="d-flex align-items-center justify-content-center" Icon="minus"
                            OnClick="OnDecrementQuantityButtonClicked"></Button>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="d-flex">
            <div class="m-0">
                <span>@Item.Quantity</span><span>g</span>
            </div>
            <div class="m-0 pl-2">
                @Item.Name
            </div>
            @if (!Item.IsTemporary)
            {
                <div class="px-2 m-0 align-self-center ml-auto">
                    <span>@(Item.Quantity * Item.PricePerQuantity)</span>
                    <span>€</span>
                </div>
            }
        </div>
    }
</li>

@code{
    [Parameter] public ShoppingListItem Item { get; set; }

    [Parameter] public EventCallback<ShoppingListItem> ItemBasketStatusChangedCallback { get; set; }
    [Parameter] public EventCallback<ShoppingListItem> ItemQuantityChangedCallback { get; set; }
    [Parameter] public EventCallback<ShoppingListItem> ItemRemovedCallback { get; set; }

    [Parameter] public bool IsInEditMode { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();
        StateHasChanged();
    }

    private async void OnItemClickedAsync()
    {
        if (IsInEditMode)
            return;

        await ItemBasketStatusChangedCallback.InvokeAsync(Item);
        StateHasChanged();
    }

    private async Task OnQuantityInputValueChangedAsync(float quantity)
    {
        Item.Quantity = quantity;
        await ItemQuantityChangedCallback.InvokeAsync(Item);
    }

    private async Task OnRemoveItemButtonClickedAsync()
    {
        await ItemRemovedCallback.InvokeAsync(Item);
    }

    private async void OnIncrementQuantityButtonClicked()
    {
        Item.Quantity += Item.QuantityType.DefaultQuantity;
        await ItemQuantityChangedCallback.InvokeAsync(Item);
    }

    private async void OnDecrementQuantityButtonClicked()
    {
        Item.Quantity -= Item.QuantityType.DefaultQuantity;
        await ItemQuantityChangedCallback.InvokeAsync(Item);
    }
}