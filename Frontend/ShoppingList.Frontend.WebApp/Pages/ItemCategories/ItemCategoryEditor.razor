@page "/item-categories/{ItemCategoryId:guid}"

@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@using Fluxor
@using global::ShoppingList.Frontend.Redux.ItemCategories.Actions
@using global::ShoppingList.Frontend.Redux.ItemCategories.States

@inject IState<ItemCategoryState> State
@inject IDispatcher Dispatcher

@namespace ProjectHermes.ShoppingList.Frontend.WebApp.Pages.ItemCategories

@if (State.Value.Editor?.ItemCategory is not null)
{
    <div>
        <div class="d-flex">
            <Button Class="d-flex align-items-center" OnClick="@OnBackButtonClicked">
                <Icon Type="arrow-left"></Icon>
            </Button>
            <div class="mx-3">
                <Input Placeholder="Name ..."
                       TValue="string"
                       Value="@State.Value.Editor.ItemCategory.Name"
                       OnChange="OnNameChanged"/>
            </div>
            @if (State.Value.Editor.ItemCategory.Id != Guid.Empty)
            {
                <Button Danger="true"
                        Class="ml-auto"
                        OnClick="@OnDeleteButtonClicked">
                    Delete
                </Button>
            }
        </div>
        <div class="d-flex justify-content-end mt-2">

            @if (State.Value.Editor.ItemCategory.Id == Guid.Empty)
            {
                <Button @onclick="@OnSaveButtonClicked">Create</Button>
            }
            else
            {
                <Button @onclick="@OnSaveButtonClicked">Save</Button>
            }
        </div>
    </div>
}

@code {
    [Parameter] public Guid ItemCategoryId { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();

        if(ItemCategoryId == Guid.Empty)
            Dispatcher.Dispatch(new SetNewItemCategoryAction());
        else
            Dispatcher.Dispatch(new LoadItemCategoryForEditingAction(ItemCategoryId));
    }
    
    private void OnBackButtonClicked()
    {
        Dispatcher.Dispatch(new LeaveItemCategoryEditorAction());
    }

    private void OnNameChanged(string name)
    {
        Dispatcher.Dispatch(new EditedItemCategoryNameChangedAction(name));
    }

    private void OnSaveButtonClicked()
    {
        Dispatcher.Dispatch(new SaveItemCategoryAction());
    }


    private void OnDeleteButtonClicked()
    {
        Dispatcher.Dispatch(new DeleteItemCategoryAction());
    }
}