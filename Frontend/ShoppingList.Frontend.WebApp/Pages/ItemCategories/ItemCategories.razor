@page "/item-categories"

@using ProjectHermes.ShoppingList.Frontend.WebApp.Pages.ItemCategories.Models
@using ProjectHermes.ShoppingList.Frontend.WebApp.Pages.ItemCategories.Services
@using ProjectHermes.ShoppingList.Frontend.Models.ItemCategories.Models
@using ProjectHermes.ShoppingList.Frontend.WebApp.Store.ItemCategories.Actions

@inject NavigationManager _navigationManager;
@inject ItemCategoriesState _state;
@inject IItemCategoryApiService _apiService

@namespace ProjectHermes.ShoppingList.Frontend.WebApp.Pages.ItemCategories

<div>
    <div class="d-flex">
        <div class="h4">ItemCategories</div>
        <Button @onclick="@OnCreateItemCategoryButtonClicked" Class="d-flex align-items-center ml-auto">
            <Icon Type="plus"></Icon>
        </Button>
    </div>
    <div>
        <Input TValue="string" @bind-value="@input" 
               OnPressEnter="@OnLoadButtonClickedAsync" 
               Placeholder="ItemCategory name ..."></Input>
        <Button @onclick="@OnLoadButtonClickedAsync" Class="mt-2">Load</Button>
    </div>
    <div>
        @foreach (var searchResult in _state.SearchResults)
        {
            <SearchResult Model="searchResult" TAction="EditItemCategoryAction"></SearchResult>
        }
    </div>
</div>

@code {
    private string input = "";

    protected override void OnInitialized()
    {
        base.OnInitialized();
        _state.ResetEditedItemCategory();
    }

    private async Task OnLoadButtonClickedAsync()
    {
        if (string.IsNullOrWhiteSpace(input))
        {
            _state.RegisterSearchResults(Enumerable.Empty<ItemCategorySearchResult>());
            return;
        }

        var results = await _apiService.SearchAsync(input);
        _state.RegisterSearchResults(results);
    }

    private void OnCreateItemCategoryButtonClicked()
    {
        _navigationManager.NavigateTo($"item-categories/{Guid.Empty}");
    }
}