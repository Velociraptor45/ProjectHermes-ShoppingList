@page "/recipes"

@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@using Fluxor
@using global::ShoppingList.Frontend.Redux.Recipes.Actions
@using global::ShoppingList.Frontend.Redux.Recipes.States

@inject IDispatcher Dispatcher
@inject IState<RecipeState> State

@using ProjectHermes.ShoppingList.Frontend.WebApp.Pages.Recipes.Models;
@using ProjectHermes.ShoppingList.Frontend.WebApp.Pages.Recipes.Services;
@*@using RecipeSearchResult = ProjectHermes.ShoppingList.Frontend.Models.Recipes.Models.RecipeSearchResult*@
@*
@inject NavigationManager _navigationManager;
@inject RecipesState _state;
@inject IRecipesApiService _apiService*@

@namespace ProjectHermes.ShoppingList.Frontend.WebApp.Pages.Recipes

<div>
    <div class="d-flex">
        <div class="h4">Recipes</div>
        <Button @onclick="@OnCreateRecipeButtonClicked" Class="d-flex align-items-center ml-auto">
            <Icon Type="plus"></Icon>
        </Button>
    </div>
    <div>
        <Input TValue="string" @bind-value="@input" 
               OnPressEnter="@OnLoadButtonClicked" 
               Placeholder="Recipe name ..."></Input>
        <Button @onclick="@OnLoadButtonClicked" Class="mt-2">Load</Button>
    </div>
    <div>
        @foreach (var searchResult in State.Value.Search.SearchResults)
        {
            <SearchResult Model="searchResult" TAction="EditRecipeAction"></SearchResult>
        }
    </div>
</div>

@code {
    private string input = "";

    protected override void OnInitialized()
    {
        base.OnInitialized();
        Dispatcher.Dispatch(new EnterRecipeSearchPageAction());
        //_state.ResetEditedRecipe();
    }

    private void OnLoadButtonClicked()
    {
        //if (string.IsNullOrWhiteSpace(input))
        //{
        //    _state.RegisterSearchResults(Enumerable.Empty<RecipeSearchResult>());
        //    return;
        //}

        //var results = await _apiService.SearchAsync(input);
        //_state.RegisterSearchResults(results);
        Dispatcher.Dispatch(new SearchRecipeAction(input));
    }

    private void OnCreateRecipeButtonClicked()
    {
        //_navigationManager.NavigateTo($"recipes/{Guid.Empty}");
        Dispatcher.Dispatch(new EditRecipeAction
        {
            Id = Guid.Empty
        });
    }
}